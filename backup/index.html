<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- 引入 Layui 的样式表 -->
  <link rel="stylesheet" href="layui/css/layui.css">
  
  <style>
    /* 网页主体居中 */
    .layui-container {
      width: 100%;
      /* 控制网页主体的最大宽度 */
      margin: 0 auto;
      padding: 20px;
      box-sizing: border-box; /* 确保 padding 不会增加容器宽度 */
    }

    /* 调整输入框和按钮宽度 */
    .layui-form-item .layui-input-inline {
      width: calc(10% - 1px); /* 输入框占据 70% 的宽度，减去间距 */
      margin-right: 10px; /* 调整右侧间距 */
    }

    .layui-form-item .layui-input-inline:last-child {
      margin-right: 0; /* 最后一个输入框无需右侧间距 */
    }

    .layui-form-item .convert-btn {
      width: 20%; /* 转换按钮占据 20% 的宽度 */
      margin-top: auto; /* 调整按钮之间的间距 */
    }

    .output-box {
      margin-top: 10px;
    }

    @media (min-width: 10px) {
      .layui-form-item .convert-btn {
        width: auto; /* 恢复按钮的自动宽度 */
      }
    }
  </style>
  
  <title>代理配置转换</title>
</head>
<body>
  <div class="layui-container">
    <h2>代理配置转换</h2>
    
    <div class="layui-form layui-form-pane">
      <div class="layui-form-item" style="display: flex; align-items: center;">
        <label class="layui-form-label" for="inputBox" style="flex: 0 0 auto;">输入代理配置：</label>
        <div class="layui-input-inline" style="width: calc(70% - 10px);">
          <input type="text" id="inputBox" v-model="inputValue" lay-verify="required" placeholder="输入代理配置（如：socks5://127.0.0.1:1080:username:password 或 http://127.0.0.1:1080:username:password）"
            autocomplete="off" class="layui-input" @keydown.enter="convert">
        </div>
        <div class="layui-input-inline">
          <button class="layui-btn layui-btn-normal convert-btn" lay-submit lay-filter="formConvert" @click="convert">转换</button>
        </div>
      </div>

      <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">转换结果：</label>
        <div class="layui-input-block">
          <textarea id="outputBox" placeholder="转换结果将显示在这里" class="layui-textarea" :value="outputValue" readonly></textarea>
          <div v-for="(format, index) in outputFormats" :key="index" class="output-box">
            <label>{{ format.label }}：</label>
            <textarea :id="'outputBox' + index" placeholder="转换结果将显示在这里" class="layui-textarea" :value="format.value" readonly></textarea>
          </div>
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-input-block">
        </div>
      </div>
    </div>
  </div>

  <!-- 引入 Layui 的 JavaScript 文件 -->
  <script src="layui/layui.js"></script>
  <!-- 引入 Vue.js -->
  <script src="vue/vue.js"></script>

  <script>
    layui.use(['form', 'layer'], function() {
      var form = layui.form;
      var layer = layui.layer;

      new Vue({
        el: '.layui-container',
        data() {
          return {
            inputValue: '',
            outputValue: '',
            outputFormats: [
              { label: '主机IP:端口:用户名:密码', value: '' },
              { label: '用户名:密码@主机IP:端口', value: '' },
              { label: '用户名:密码:主机IP:端口', value: '' },
              { label: '主机IP:端口@用户名:密码', value: '' }
            ]
          };
        },
        methods: {
          convert() {
            const proxyInput = this.inputValue.trim();
            if (!proxyInput) {
              layer.msg('请输入代理配置');
              return;
            }
            
            const parts = proxyInput.split('://');
            if (parts.length !== 2) {
              layer.msg('代理配置格式错误');
              return;
            }

            const protocol = parts[0];
            const credentialsAndAddress = parts[1];
            const addressAndPortAndOthers = credentialsAndAddress.split(':');

            if (addressAndPortAndOthers.length < 2) {
              layer.msg('代理配置格式错误');
              return;
            }

            const address = addressAndPortAndOthers[0];
            const port = addressAndPortAndOthers[1];
            const username = addressAndPortAndOthers[2] || '';
            const password = addressAndPortAndOthers[3] || '';

            // Format 1: 主机IP:端口:用户名:密码
            this.outputFormats[0].value = `${address}:${port}:${username}:${password}`;

            // Format 2: 用户名:密码@主机IP:端口
            this.outputFormats[1].value = `${username}:${password}@${address}:${port}`;

            // Format 3: 用户名:密码:主机IP:端口
            this.outputFormats[2].value = `${username}:${password}:${address}:${port}`;

            // Format 4: 主机IP:端口@用户名:密码
            this.outputFormats[3].value = `${address}:${port}@${username}:${password}`;

            // Original format
            const originalParts = this.inputValue.split(':');
            if (originalParts.length >= 4) {
              this.outputValue = `类型：${protocol}，主机 IP：${address}，端口：${port}，用户名：${username}，密码：${password}`;
            } else {
              this.outputValue = '无效的代理配置';
            }
          },
        }
      });

      // 监听表单提交事件，阻止页面跳转
      form.on('submit(formConvert)', function(data) {
        return false; // 阻止表单跳转。因为这里我们使用了 Vue 来处理转换操作。
      });
    });
  </script>
</body>
</html>
